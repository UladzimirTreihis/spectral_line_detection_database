{% extends "./base.html" %}

{% block title %}
    Advanced Search
{% endblock %}

{% block script %}
    <script src=
"https://code.jquery.com/jquery-3.2.1.slim.min.js" 
                integrity=
"sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" 
                crossorigin="anonymous">
    </script>
    <script src=
"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" 
                integrity=
"sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" 
                crossorigin="anonymous">
    </script>
    <script src=
"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" 
                integrity=
"sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
                crossorigin="anonymous">
    </script>
    <script src=
"https://code.jquery.com/jquery-3.5.1.js"
                integrity=
"sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" 
                crossorigin="anonymous">
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script type="text/javascript" src="{{ url_for('static', filename='js/coordinates.js') }}"></script>
{% endblock %}

{% block content %}

<hr>
<h1> Advanced Search </h1>
<br>

<form action= {{url_for('main.query_results')}} method='POST' id='galaxyForm'>
   {{form_advanced.hidden_tag() }}
   <div class = "entry">
      <p>
            {{ form_advanced.name.label }}<br>
            {{ form_advanced.name(size=32) }}<br>
            {% for error in form_advanced.name.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
      </p>
       <p>Position search within a range:</p>
      <div style="display: flex;">
         <p>
            {{ form_advanced.right_ascension_min.label }}<br>
            {{ form_advanced.right_ascension_min(size=20) }}<br>
            {% for error in form_advanced.right_ascension_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.right_ascension_max.label }}<br>
            {{ form_advanced.right_ascension_max(size=20) }}<br>
            {% for error in form_advanced.right_ascension_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.declination_min.label }}<br>
            {{ form_advanced.declination_min(size=20) }}<br>
            {% for error in form_advanced.declination_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.declination_max.label }}<br>
            {{ form_advanced.declination_max(size=20) }}<br>
            {% for error in form_advanced.declination_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <p>Position search within a radius:</p>
      <div style="display: flex;">
         <p>
            Center {{ form_advanced.right_ascension_point.label }}<br>
            {{ form_advanced.right_ascension_point(size=20) }}<br>
            {% for error in form_advanced.right_ascension_point.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            Center {{ form_advanced.declination_point.label }}<br>
            {{ form_advanced.declination_point(size=20) }}<br>
            {% for error in form_advanced.declination_point.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <p>Radius:</p>
      <div style="display: flex;">
         <p>
            {{ form_advanced.radius_d.label }}<br>
            {{ form_advanced.radius_d(size=3) }}<br>
            {% for error in form_advanced.radius_d.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.radius_m.label }}<br>
            {{ form_advanced.radius_m(size=3) }}<br>
            {% for error in form_advanced.radius_m.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.radius_s.label }}<br>
            {{ form_advanced.radius_s(size=4) }}<br>
            {% for error in form_advanced.radius_s.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.redshift_min.label }}<br>
            {{ form_advanced.redshift_min(size=20) }}<br>
            {% for error in form_advanced.redshift_min.errors %}
            <span style="color: red;">[{{error}}]</span>
            {% endfor %}

         </p>
         <p>
            {{ form_advanced.redshift_max.label }}<br>
            {{ form_advanced.redshift_max(size=20) }}<br>
            {% for error in form_advanced.redshift_max.errors %}
            <span style="color: red;">[{{error}}]</span>
            {% endfor %}
         </p>
      </div>
      <p>
            {{ form_advanced.lensing_flag.label }}<br>
            {{ form_advanced.lensing_flag }}<br>
            {% for error in form_advanced.lensing_flag.errors %}
            <span style="color: red;">[{{error}}]</span>
            {% endfor %}

      </p>
      <p>
         {{ form_advanced.classification.label }}<br>
         {{ form_advanced.classification }}<br>
         {% for error in form_advanced.classification.errors %}
         <span style="color: red;">[{{error}}]</span>
         {% endfor %}

   </p>
   <p>
      {{ form_advanced.remove_classification.label }}<br>
      {{ form_advanced.remove_classification }}<br>
      {% for error in form_advanced.classification.errors %}
      <span style="color: red;">[{{error}}]</span>
      {% endfor %}

</p>
      <br>
      <br>
      </div>
      <div class = "entry">
      <p>Here you can additionally sort galaxies that have at least one line that falls under the specified Line parameters</p>
      <div style="display: flex;">
         <p>
            {{ form_advanced.species.label }}<br>
            {{ form_advanced.species }}<br>
            {% for error in form_advanced.species.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.emitted_frequency_min.label }}<br>
            {{ form_advanced.emitted_frequency_min(size=20) }}<br>
            {% for error in form_advanced.emitted_frequency_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.emitted_frequency_max.label }}<br>
            {{ form_advanced.emitted_frequency_max(size=20) }}<br>
            {% for error in form_advanced.emitted_frequency_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.observed_line_frequency_min.label }}<br>
            {{ form_advanced.observed_line_frequency_min(size=20) }}<br>
            {% for error in form_advanced.observed_line_frequency_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.observed_line_frequency_max.label }}<br>
            {{ form_advanced.observed_line_frequency_max(size=20) }}<br>
            {% for error in form_advanced.observed_line_frequency_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.integrated_line_flux_min.label }}<br>
            {{ form_advanced.integrated_line_flux_min(size=20) }}<br>
            {% for error in form_advanced.integrated_line_flux_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.integrated_line_flux_max.label }}<br>
            {{ form_advanced.integrated_line_flux_max(size=20) }}<br>
            {% for error in form_advanced.integrated_line_flux_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.peak_line_flux_min.label }}<br>
            {{ form_advanced.peak_line_flux_min(size=20) }}<br>
            {% for error in form_advanced.peak_line_flux_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.peak_line_flux_max.label }}<br>
            {{ form_advanced.peak_line_flux_max(size=20) }}<br>
            {% for error in form_advanced.peak_line_flux_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.line_width_min.label }}<br>
            {{ form_advanced.line_width_min(size=20) }}<br>
            {% for error in form_advanced.line_width_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.line_width_max.label }}<br>
            {{ form_advanced.line_width_max(size=20) }}<br>
            {% for error in form_advanced.line_width_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>

      <p>
         {{ form_advanced.detection_type.label }}<br>
         {{ form_advanced.detection_type }}<br>
         {% for error in form_advanced.detection_type.errors %}
         <span style="color: red;">[{{ error }}]</span>
         {% endfor %}
      </p>
      <div style="display: flex;">
         <p>
            {{ form_advanced.observed_beam_major_min.label }}<br>
            {{ form_advanced.observed_beam_major_min(size=20) }}<br>
            {% for error in form_advanced.observed_beam_major_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.observed_beam_major_max.label }}<br>
            {{ form_advanced.observed_beam_major_max(size=20) }}<br>
            {% for error in form_advanced.observed_beam_major_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <div style="display: flex;">
         <p>
            {{ form_advanced.observed_beam_minor_min.label }}<br>
            {{ form_advanced.observed_beam_minor_min(size=20) }}<br>
            {% for error in form_advanced.observed_beam_minor_min.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
         <p>
            {{ form_advanced.observed_beam_minor_max.label }}<br>
            {{ form_advanced.observed_beam_minor_max(size=20) }}<br>
            {% for error in form_advanced.observed_beam_minor_max.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
         </p>
      </div>
      <p>
         {{ form_advanced.reference.label }}<br>
         {{ form_advanced.reference(size=32) }}<br>
         {% for error in form_advanced.reference.errors %}
         <span style="color: red;">[{{ error }}]</span>
         {% endfor %}
      </p>
      </div>
      <div class = "buttons">
      <button type="button"> 
         {{ form_advanced.galaxySearch() }}
      </button>
      <button type="button"> 
         {{ form_advanced.lineSearch() }}
      </button>
      </div>
      <style>
      .entry {
            width: 50%;
            float: left;
      }
      .buttons {
         text-align: center;
      }
      </style>
</form>
   


{% if form_advanced.galaxySearch.data %}
<!--Supposed to desplay the results. In the development stage-->
<table class = "table" id = "Galaxy">
   <thead>
      <tr>
         <th>Name</th>
         <th>Right Ascension</th>
         <th>Declination</th>
         <th>Coordinate System</th>
         <th>Redshift</th>
         <th>Lensing Flag</th>
         <th>Classification</th>
         <th>Notes</th>
      </tr>
   </thead>
    
   <tbody>
      {% for element in galaxies %}
         {% set l = element[1] %}  
         {% set g = element[0] %}
         <tr>
            <td><a href="{{ url_for('main.galaxy', name=g.name) }}">{{ g.name }}</a></td>
            <td>{{ g.right_ascension }}</td>
            <td>{{ g.declination }}</td>
            <td>{{ g.coordinate_system }}</td>
            <td>{{ g.redshift }}</td>
            <td>{{ g.lensing_flag }}</td>
            <td>{{ g.classification }}</td>
            <td> <button class="gfgselect btn btn-info" data-toggle="modal" data-target="#gfgmodal"> Show </button></td>   
            <td class = "notes" style = "display:none"> {{g.notes}} </td>          </tr>
      {% endfor %}
   </tbody>
</table>

{% endif %}
{% if form_advanced.lineSearch.data %}
<table class = "table" id = "Line">
   <thead>
      <tr>
         <th>Galaxy Name</th>
         <th>\( Species \)</th>
         <th>\( f_{rest} \) \( (GHz) \)</th>
         <th>\( S \Delta v \) \((Jy \ km \ s^{-1}) \)</th>
         <th>\( +\sigma_{S \Delta V} \) \( (Jy \ km \ s^{-1}) \)</th>
         <th>\( -\sigma_{S \Delta V} \) \( (Jy \ km \ s^{-1}) \)</th>
         <th>\( S_{max} \) \( (mJy) \)</th>
         <th>\( +\sigma_{S_max} \) \( (mJy) \)</th>
         <th>\( -\sigma_{S_max} \) \( (mJy) \)</th>
         <th>\( FWHM \) \( (kms^{-1}) \)</th>
         <th>\( +\sigma_{FWHM} \) \( (kms^{-1}) \)</th>
         <th>\( -\sigma_{FWHM} \) \( (kms^{-1}) \)</th>
         <th>\( f_{obs} \) \( (GHz) \)</th>
         <th>\( +\sigma_{f_{obs}} \) \( (GHz) \)</th>
         <th>\( -\sigma_{f_{obs}} \) \( (GHz) \)</th>
         <th>\( Telescope \) \( Type \)</th>
         <th>\( Beam \ Maj. \) \(FWHM ('') \)</th>
         <th>\( Beam \ Min. \) \(FWHM ('') \)</th>
         <th>\( Beam \ P.A. \) \( (*) \)</th>
         <th>\( Reference \)</th>
         <th>\( Notes \)</th>
         <th style = "display: none">\( Text \) </th>
      </tr>
   </thead>
   
   <tbody>
      {% for element in galaxies %}
         {% set l = element[1] %}  
         {% set g = element[0] %}
         <tr>
            <td><a href="{{ url_for('main.galaxy', name=g.name) }}">{{ g.name }}</a></td>
            <td>{{ l.species }}</td>
            <td>{{ l.emitted_frequency }}</td>
            <td>{{ l.integrated_line_flux }}</td>
            <td>{{ l.integrated_line_flux_uncertainty_positive }}</td>
            <td>
               {% if l.integrated_line_flux_uncertainty_negative == None %}
                  {{ l.integrated_line_flux_uncertainty_positive }}
               {% else %}
                  {{ l.integrated_line_flux_uncertainty_negative }}
               {% endif %}
            </td>
            <td>{{ l.peak_line_flux }}</td>
            <td>{{ l.peak_line_flux_uncertainty_positive }}</td>
            <td>
               {% if l.peak_line_flux_uncertainty_negative == None %}
                  {{ l.peak_line_flux_uncertainty_positive }}
               {% else %}
                  {{ l.peak_line_flux_uncertainty_negative }}
               {% endif %}
            </td>
            <td>{{ l.line_width }}</td>
            <td>{{ l.line_width_uncertainty_positive }}</td>
            <td>
               {% if l.line_width_uncertainty_negative == None %}
                  {{ l.line_width_uncertainty_positive }}
               {% else %}
                  {{ l.line_width_uncertainty_negative }}
               {% endif %}
            </td>
            <td>{{ l.observed_line_frequency }}</td>
            <td>{{ l.observed_line_frequency_uncertainty_positive }}</td>
            <td>
               {% if l.observed_line_frequency_uncertainty_negative == None %}
                  {{ l.observed_line_frequency_uncertainty_positive }}
               {% else %}
                  {{ l.observed_line_frequency_uncertainty_negative }}
               {% endif %}
            </td>                
            <td>{{ l.detection_type }}</td>
            <td>{{ l.observed_beam_major }}</td>
            <td>{{ l.observed_beam_minor }}</td>
            <td>{{ l.observed_beam_angle }}</td>
            <td>{{ l.reference }}</td>
            <td> <button class="gfgselect btn btn-info" data-toggle="modal" data-target="#gfgmodal"> Show </button></td>   
            <td class = "notes" style = "display:none"> {{l.notes}} </td> 
         </tr>
      {% endfor %}
   </tbody>
</table> 
{% endif %}
<script type="text/javascript" src="{{ url_for('static', filename='js/coordinates.js') }}"></script>
    <script>
        $(function () {
            $(".gfgselect").click(function () {
                var notes = $(this).parents("tr").find(".notes").text();
                var p = "";
                p += "<p> " + notes + "</p>";
                $("#divGFG").empty();
                $("#divGFG").append(p);
            });
        });
    </script>
    <div class="modal fade" 
         id="gfgmodal"
         tabindex="-1"
         role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"
                        id="gfgmodallabel">
                      Notes</h2>
                    <button type="button" 
                            class="close"
                            data-dismiss="modal" 
                            aria-label="Close">
                        <span aria-hidden="true">
                          ×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="GFGclass" 
                         id="divGFG"></div>
                    <div class="modal-footer">
                        <button type="button"
                                class="btn btn-secondary" 
                                data-dismiss="modal">
                          Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}